# FLUXOGRAMA - UniClass Classifier para Revit 2024

## ?? VISÃO GERAL DO SISTEMA

```
???????????????????????????????????????????????????????????????????
?                    UniClass Classifier                          ?
?              Classificação Automática UniClass 2015             ?
???????????????????????????????????????????????????????????????????
```

## ?? FLUXO PRINCIPAL DA APLICAÇÃO

### **FASE 1: INICIALIZAÇÃO DO PLUGIN**

```
INÍCIO
    ?
CoordinatorProApp.OnStartup()
    ?
???????????????????????????????????????
? 1. Criar aba "CoordinatorPro"       ?
?    no Ribbon do Revit               ?
???????????????????????????????????????
? 2. Criar painel "UniClass"          ?
???????????????????????????????????????
? 3. Adicionar botão "UniClass 2015"  ?
?    - Tooltip e descrição            ?
???????????????????????????????????????
    ?
PLUGIN CARREGADO NO REVIT
```

### **FASE 2: EXECUÇÃO DO COMANDO**

```
USUÁRIO CLICA NO BOTÃO "UniClass 2015"
    ?
ClassifyCommand.Execute()
    ?
???????????????????????????????????????
? 1. Validação inicial                ?
?    - UIDocument ativo?              ?
?    - Document válido?               ?
???????????????????????????????????????
? 2. Inicializar ClassificationService?
?    - Carregar base UniClass         ?
???????????????????????????????????????
    ?
SUCESSO? ? SIM ? CONTINUAR
    ?
NÃO ? MOSTRAR ERRO ? FIM
```

### **FASE 3: SELEÇÃO DE ELEMENTOS**

```
CONTINUAR
    ?
GetElementsToClassify()
    ?
???????????????????????????????????????
? 1. Verificar seleção atual          ?
?    - Elementos selecionados?        ?
???????????????????????????????????????
? 2. Filtrar elementos válidos        ?
?    - Category != null               ?
?    - Não é View                     ?
?    - ID válido                      ?
???????????????????????????????????????
? 3. Se nenhum elemento selecionado:  ?
?    - Pedir nova seleção             ?
?    - Usar ElementSelectionFilter    ?
???????????????????????????????????????
    ?
ELEMENTOS SELECIONADOS?
    ?
SIM ? CONTINUAR
    ?
NÃO ? CANCELAR ? FIM
```

### **FASE 4: SELEÇÃO DE PARÂMETROS**

```
ELEMENTOS SELECIONADOS
    ?
ParameterService.GetEditableParameters()
    ?
???????????????????????????????????????
? 1. Coletar parâmetros built-in      ?
?    - Comments, Mark, Type Mark, etc ?
???????????????????????????????????????
? 2. Adicionar parâmetros de instância?
?    - StorageType == String          ?
?    - !IsReadOnly                    ?
???????????????????????????????????????
? 3. Adicionar parâmetros do Type     ?
?    - Prefixo "[Type] "              ?
???????????????????????????????????????
? 4. Ordenar alfabeticamente          ?
???????????????????????????????????????
    ?
PARÂMETROS DISPONÍVEIS?
    ?
SIM ? MOSTRAR FORM DE SELEÇÃO
    ?
NÃO ? MOSTRAR ERRO ? FIM
```

### **FASE 5: FORM DE SELEÇÃO DE PARÂMETROS**

```
PARÂMETROS DISPONÍVEIS
    ?
ParameterSelectionForm.ShowDialog()
    ?
???????????????????????????????????????
? FORM: ParameterSelectionForm        ?
???????????????????????????????????????
? • ComboBox: cmbParameters           ?
?   - Lista parâmetros disponíveis     ?
???????????????????????????????????????
? • CheckBox: chkRememberChoice       ?
?   - Lembrar escolha                 ?
???????????????????????????????????????
? • GroupBox: Opções de Classificação ?
?   - rbSingleElement                 ?
?   - rbMultipleElements              ?
?   - rbAllVisible                    ?
???????????????????????????????????????
? • Label: lblElementCount            ?
?   - "X elementos selecionados"      ?
???????????????????????????????????????
? • CheckBox: chkShowProgress         ?
?   - Mostrar progresso               ?
???????????????????????????????????????
? • Botões: OK / Cancel               ?
???????????????????????????????????????
    ?
USUÁRIO CLICA OK?
    ?
SIM ? CONTINUAR
    ?
NÃO ? CANCELAR ? FIM
```

### **FASE 6: CARREGAMENTO DE CONFIGURAÇÕES**

```
USUÁRIO CLICA OK
    ?
SettingsManager.Load()
    ?
???????????????????????????????????????
? 1. Caminho: %AppData%\UniClass...   ?
???????????????????????????????????????
? 2. Arquivo: settings.json           ?
???????????????????????????????????????
? 3. Carregar configurações           ?
?    - LastParameter                  ?
?    - ShowProgress                   ?
?    - RememberChoice                 ?
???????????????????????????????????????
? 4. Se arquivo não existe:           ?
?    - Usar valores padrão            ?
???????????????????????????????????????
    ?
CONFIGURAÇÕES CARREGADAS
```

### **FASE 7: PROCESSAMENTO DOS ELEMENTOS**

```
CONFIGURAÇÕES CARREGADAS
    ?
ClassifyElements()
    ?
???????????????????????????????????????
? 1. Se showProgress:                 ?
?    - Criar ProgressForm             ?
?    - Mostrar form                   ?
???????????????????????????????????????
? 2. Iniciar Transaction              ?
???????????????????????????????????????
? 3. Para cada elemento:              ?
?    ???????????????????????????????  ?
?    ? a. Verificar cancelamento   ?  ?
?    ? b. Coletar dados elemento   ?  ?
?    ? c. Classificar com fuzzy    ?  ?
?    ? d. Atualizar parâmetro      ?  ?
?    ? e. Atualizar progresso      ?  ?
?    ???????????????????????????????  ?
???????????????????????????????????????
? 4. Commit Transaction              ?
???????????????????????????????????????
? 5. Mostrar resumo no ProgressForm  ?
???????????????????????????????????????
    ?
PROCESSAMENTO CONCLUÍDO
```

### **FASE 8: COLETA DE DADOS DO ELEMENTO**

```
PARA CADA ELEMENTO
    ?
ParameterService.CollectElementData()
    ?
???????????????????????????????????????
? 1. Category: element.Category.Name  ?
???????????????????????????????????????
? 2. Family: ELEM_FAMILY_PARAM        ?
???????????????????????????????????????
? 3. Type: element.Name               ?
???????????????????????????????????????
? 4. Parâmetros importantes:          ?
?    - Assembly Code                  ?
?    - Assembly Description           ?
?    - Keynote                        ?
?    - Description                    ?
?    - Manufacturer                   ?
?    - Model                          ?
?    - Material                       ?
???????????????????????????????????????
    ?
DADOS COLETADOS
```

### **FASE 9: CLASSIFICAÇÃO FUZZY**

```
DADOS COLETADOS
    ?
ClassificationService.Classify()
    ?
???????????????????????????????????????
? 1. Verificar cache                  ?
?    - Chave: Category|Family|Type    ?
???????????????????????????????????????
? 2. Se não no cache:                 ?
?    ???????????????????????????????  ?
?    ? a. Construir string busca   ?  ?
?    ?    - Pesos: Cat(3x), Fam(2x)?  ?
?    ? b. FuzzySharp.ExtractTop()  ?  ?
?    ? c. Encontrar melhor match    ?  ?
?    ? d. Adicionar ao cache       ?  ?
?    ???????????????????????????????  ?
???????????????????????????????????????
? 3. Retornar ClassificationResult    ?
?    - Code, Confidence, Source       ?
?    - Alternatives                   ?
???????????????????????????????????????
    ?
CLASSIFICAÇÃO OBTIDA
```

### **FASE 10: ATUALIZAÇÃO DO PARÂMETRO**

```
CLASSIFICAÇÃO OBTIDA
    ?
ParameterService.SetParameterValue()
    ?
???????????????????????????????????????
? 1. Determinar tipo de parâmetro     ?
?    - Instância ou Type?             ?
???????????????????????????????????????
? 2. Obter referência do parâmetro    ?
?    - element.LookupParameter()      ?
?    - ou type.LookupParameter()      ?
???????????????????????????????????????
? 3. Validar parâmetro                ?
?    - !IsReadOnly                    ?
?    - StorageType == String          ?
???????????????????????????????????????
? 4. Definir valor                    ?
?    - Truncar se > 255 chars         ?
???????????????????????????????????????
? 5. Retornar sucesso/fracasso        ?
???????????????????????????????????????
    ?
PARÂMETRO ATUALIZADO
```

### **FASE 11: ATUALIZAÇÃO DO PROGRESSO**

```
PARÂMETRO ATUALIZADO
    ?
ProgressForm.UpdateProgress()
    ?
???????????????????????????????????????
? 1. Atualizar ProgressBar            ?
?    - current / total                ?
???????????????????????????????????????
? 2. Atualizar labels                 ?
?    - lblCurrent: "X / Y"            ?
?    - lblStatus: "Processando: Name" ?
???????????????????????????????????????
? 3. Adicionar linha no DataGridView  ?
?    - ID, Name, Classification,      ?
?      Confidence, Status             ?
???????????????????????????????????????
? 4. Auto-scroll para última linha    ?
???????????????????????????????????????
? 5. Application.DoEvents()           ?
???????????????????????????????????????
    ?
PROGRESSO ATUALIZADO
```

### **FASE 12: FINALIZAÇÃO E RESUMO**

```
TODOS OS ELEMENTOS PROCESSADOS
    ?
ProgressForm.ShowSummary()
    ?
???????????????????????????????????????
? 1. Calcular estatísticas            ?
?    - Total, Sucesso, Parcial, Falha ?
???????????????????????????????????????
? 2. Atualizar lblStatus              ?
?    - "Concluído: X/Y classificados" ?
???????????????????????????????????????
? 3. Habilitar btnExport              ?
???????????????????????????????????????
? 4. Se chkAutoClose: Close()         ?
???????????????????????????????????????
    ?
ShowSummary() NO ClassifyCommand
    ?
???????????????????????????????????????
? 1. Calcular métricas finais         ?
?    - Confiança média                ?
?    - Estatísticas detalhadas        ?
???????????????????????????????????????
? 2. Mostrar TaskDialog               ?
?    - Resultado da classificação     ?
???????????????????????????????????????
? 3. Dicas se muitos não classificados?
???????????????????????????????????????
    ?
PROCESSO CONCLUÍDO
```

## ?? FLUXOS ALTERNATIVOS

### **CANCELAMENTO PELO USUÁRIO**

```
QUALQUER PONTO DO PROCESSO
    ?
USUÁRIO CLICA CANCELAR
    ?
???????????????????????????????????????
? 1. Definir flag _cancelled = true   ?
???????????????????????????????????????
? 2. RollBack Transaction (se ativa) ?
???????????????????????????????????????
? 3. Fechar ProgressForm              ?
???????????????????????????????????????
? 4. Retornar Result.Cancelled        ?
???????????????????????????????????????
```

### **ERRO DURANTE PROCESSAMENTO**

```
QUALQUER PONTO DO PROCESSO
    ?
EXCEÇÃO OCORRE
    ?
???????????????????????????????????????
? 1. RollBack Transaction             ?
???????????????????????????????????????
? 2. Fechar forms abertos             ?
???????????????????????????????????????
? 3. Mostrar TaskDialog de erro       ?
???????????????????????????????????????
? 4. Retornar Result.Failed           ?
???????????????????????????????????????
```

## ?? ESTRUTURA DE DADOS

### **ClassificationResult**
```
{
    string Code;           // "Pr_20_10_10 - Paredes externas"
    int Confidence;        // 0-100
    string Source;         // "Cache", "FuzzyMatch", "Error"
    List<string> Alternatives; // ["Pr_20_10_20 (85%)", ...]
}
```

### **Settings**
```
{
    string LastParameter;   // "Comments"
    bool ShowProgress;     // true
    bool RememberChoice;   // true
    int MinConfidence;     // 70
    Dictionary<string,string> CategoryMappings;
}
```

## ?? PONTOS DE DECISÃO

1. **Elementos selecionados?** ? Se não, pedir nova seleção
2. **Parâmetros disponíveis?** ? Se não, mostrar erro
3. **Usuário confirmou?** ? Se não, cancelar
4. **Mostrar progresso?** ? Se sim, criar ProgressForm
5. **Cancelamento solicitado?** ? Se sim, rollback e sair
6. **Confiança suficiente?** ? Se não, marcar como parcial
7. **Auto-close ativado?** ? Se sim, fechar automaticamente

## ?? SERVIÇOS UTILIZADOS

- **ClassificationService**: Lógica de classificação fuzzy
- **ParameterService**: Manipulação de parâmetros Revit
- **SettingsManager**: Persistência de configurações
- **ProgressForm**: Interface de progresso
- **ParameterSelectionForm**: Seleção de parâmetros

---

**FIM DO FLUXOGRAMA** ??

Este fluxograma mostra o caminho completo desde o clique no botão até a conclusão da classificação, incluindo todos os pontos de decisão, validações e tratamento de erros.